<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SkillGate Admin Dashboard - Modern</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script type="text/javascript"
        src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    
    <style>
        :root {
            --primary-color: #3B82F6;
            --secondary-color: #10B981;
            --accent-color: #F59E0B;
            --danger-color: #EF4444;
            --purple-color: #8B5CF6;
            --pink-color: #EC4899;
            --bg-light: #F8FAFC;
            --bg-white: #FFFFFF;
            --text-primary: #1E293B;
            --text-secondary: #64748B;
            --text-muted: #94A3B8;
            --border-color: #E2E8F0;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
            --shadow-xl: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-success: linear-gradient(135deg, #10B981 0%, #059669 100%);
            --gradient-warning: linear-gradient(135deg, #F59E0B 0%, #D97706 100%);
            --gradient-danger: linear-gradient(135deg, #EF4444 0%, #DC2626 100%);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-light);
            color: var(--text-primary);
            line-height: 1.6;
            font-size: 14px;
        }

        /* Login Page Styles */
        .login-container {
            min-height: 100vh;
            background: var(--gradient-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .login-card {
            background: var(--bg-white);
            border-radius: 24px;
            padding: 48px;
            box-shadow: var(--shadow-xl);
            width: 100%;
            max-width: 420px;
            text-align: center;
            border: 1px solid var(--border-color);
        }

        .login-title {
            color: var(--text-primary);
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 8px;
        }

        .login-subtitle {
            color: var(--text-secondary);
            font-size: 1rem;
            margin-bottom: 32px;
        }

        .form-control {
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 16px 20px;
            font-size: 1rem;
            margin-bottom: 20px;
            transition: all 0.3s ease;
            background-color: var(--bg-white);
        }

        .form-control:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
            outline: none;
        }

        .btn-login {
            background: var(--gradient-primary);
            border: none;
            border-radius: 12px;
            padding: 16px 32px;
            font-size: 1.1rem;
            font-weight: 600;
            color: white;
            width: 100%;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-md);
        }

        .btn-login:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        /* Dashboard Layout */
        .dashboard-container {
            display: none;
            min-height: 100vh;
        }

        .sidebar {
            width: 280px;
            background: var(--bg-white);
            color: var(--text-primary);
            position: fixed;
            height: 100vh;
            left: 0;
            top: 0;
            z-index: 1000;
            overflow-y: auto;
            transition: all 0.3s ease;
            border-right: 1px solid var(--border-color);
            box-shadow: var(--shadow-sm);
        }

        .sidebar-header {
            padding: 32px 24px;
            border-bottom: 1px solid var(--border-color);
            text-align: center;
        }

        .sidebar-header h3 {
            font-size: 1.5rem;
            font-weight: 700;
            margin: 0;
            background: var(--gradient-primary);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .sidebar-nav {
            padding: 24px 0;
        }

        .sidebar-nav a {
            display: flex;
            align-items: center;
            padding: 16px 24px;
            color: var(--text-secondary);
            text-decoration: none;
            transition: all 0.3s ease;
            font-weight: 500;
            border-left: 3px solid transparent;
            margin: 4px 0;
        }

        .sidebar-nav a i {
            margin-right: 16px;
            font-size: 1.2rem;
            width: 24px;
            text-align: center;
        }

        .sidebar-nav a:hover {
            background-color: rgba(59, 130, 246, 0.05);
            color: var(--primary-color);
            border-left-color: var(--primary-color);
        }

        .sidebar-nav a.active {
            background-color: rgba(59, 130, 246, 0.1);
            color: var(--primary-color);
            border-left-color: var(--primary-color);
            font-weight: 600;
        }

        .main-content {
            margin-left: 280px;
            min-height: 100vh;
            background-color: var(--bg-light);
        }

        .top-navbar {
            background: var(--bg-white);
            padding: 24px 32px;
            box-shadow: var(--shadow-sm);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 999;
            border-bottom: 1px solid var(--border-color);
        }

        .top-navbar h1 {
            font-size: 1.875rem;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .user-info span {
            font-weight: 500;
            color: var(--text-secondary);
        }

        .btn-logout {
            background: var(--gradient-danger);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-sm);
        }

        .btn-logout:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        .content-wrapper {
            padding: 32px;
        }

        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
            animation: fadeIn 0.5s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 32px;
            display: flex;
            align-items: center;
        }

        .section-title i {
            margin-right: 16px;
            color: var(--primary-color);
        }

        /* Stats Cards */
        .stats-row {
            margin-bottom: 32px;
        }

        .stat-card {
            background: var(--bg-white);
            border-radius: 20px;
            padding: 32px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
            height: 100%;
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--gradient-primary);
        }

        .stat-card.success::before {
            background: var(--gradient-success);
        }

        .stat-card.warning::before {
            background: var(--gradient-warning);
        }

        .stat-card.danger::before {
            background: var(--gradient-danger);
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .stat-card .icon {
            width: 64px;
            height: 64px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
            margin-bottom: 20px;
        }

        .stat-card.primary .icon { background: var(--gradient-primary); }
        .stat-card.success .icon { background: var(--gradient-success); }
        .stat-card.warning .icon { background: var(--gradient-warning); }
        .stat-card.danger .icon { background: var(--gradient-danger); }

        .stat-card h3 {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--text-primary);
            margin-bottom: 8px;
            line-height: 1;
        }

        .stat-card p {
            color: var(--text-secondary);
            font-weight: 500;
            margin: 0;
            font-size: 1rem;
        }

        /* Table Styles */
        .table-card {
            background: var(--bg-white);
            border-radius: 20px;
            padding: 32px;
            box-shadow: var(--shadow-sm);
            margin-bottom: 32px;
            border: 1px solid var(--border-color);
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            flex-wrap: wrap;
            gap: 16px;
        }

        .table-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            margin: 0;
        }

        .table-controls {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .search-box {
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 12px 16px;
            font-size: 0.875rem;
            transition: all 0.3s ease;
            min-width: 240px;
            background: var(--bg-white);
        }

        .search-box:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .filter-select {
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 12px 16px;
            font-size: 0.875rem;
            background: var(--bg-white);
            min-width: 160px;
            transition: all 0.3s ease;
        }

        .filter-select:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .btn-export {
            background: var(--gradient-primary);
            color: white;
            border: none;
            border-radius: 12px;
            padding: 12px 20px;
            font-size: 0.875rem;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-sm);
        }

        .btn-export:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-md);
        }

        /* Custom DataTable Styles */
        .dataTables_wrapper {
            font-family: 'Inter', sans-serif;
        }

        .table {
            border-collapse: separate;
            border-spacing: 0;
        }

        .table thead th {
            background: linear-gradient(135deg, #10B981 0%, #059669 100%);
            color: white;
            border: none;
            padding: 20px 16px;
            font-weight: 600;
            text-align: center;
            font-size: 0.875rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .table thead th:first-child {
            border-top-left-radius: 12px;
        }

        .table thead th:last-child {
            border-top-right-radius: 12px;
        }

        .table tbody td {
            padding: 16px;
            border-bottom: 1px solid var(--border-color);
            vertical-align: middle;
            text-align: center;
            font-size: 0.875rem;
        }

        .table tbody tr:hover {
            background-color: rgba(59, 130, 246, 0.02);
        }

        .table tbody tr:last-child td {
            border-bottom: none;
        }

        .btn-action {
            padding: 8px 12px;
            border-radius: 8px;
            border: none;
            font-size: 0.75rem;
            margin: 0 4px;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .btn-edit {
            background: var(--gradient-success);
            color: white;
        }

        .btn-delete {
            background: var(--gradient-danger);
            color: white;
        }

        .btn-action:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow-sm);
        }

        /* Chart Container */
        .chart-container {
            background: var(--bg-white);
            border-radius: 20px;
            padding: 32px;
            box-shadow: var(--shadow-sm);
            margin-bottom: 32px;
            border: 1px solid var(--border-color);
        }

        .chart-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 24px;
            text-align: center;
        }

        .chart-wrapper {
            position: relative;
            height: 400px;
        }

        /* Settings Card */
        .settings-card {
            background: var(--bg-white);
            border-radius: 20px;
            padding: 32px;
            box-shadow: var(--shadow-sm);
            margin-bottom: 24px;
            border: 1px solid var(--border-color);
        }

        .settings-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 24px;
        }

        .form-check {
            margin-bottom: 20px;
        }

        .form-check-input:checked {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }

        .form-check-label {
            font-weight: 500;
            color: var(--text-secondary);
        }

        /* Export Modal */
        .modal-content {
            border-radius: 20px;
            border: none;
            box-shadow: var(--shadow-xl);
        }

        .modal-header {
            background: var(--gradient-primary);
            color: white;
            border-radius: 20px 20px 0 0;
            padding: 24px 32px;
        }

        .modal-title {
            font-weight: 700;
        }

        .btn-close {
            filter: invert(1);
        }

        .modal-body {
            padding: 32px;
        }

        .modal-footer {
            padding: 24px 32px;
            border-top: 1px solid var(--border-color);
        }

        /* Status Badge Styles */
        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-block;
            border: 1px solid transparent;
        }

        .status-badge:hover {
            transform: scale(1.05);
        }

        .status-badge.status-active {
            background: rgba(16, 185, 129, 0.1);
            color: var(--secondary-color);
            border-color: var(--secondary-color);
        }

        .status-badge.status-inactive {
            background: rgba(239, 68, 68, 0.1);
            color: var(--danger-color);
            border-color: var(--danger-color);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .sidebar {
                width: 100%;
                transform: translateX(-100%);
            }

            .sidebar.show {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .top-navbar {
                padding: 16px 20px;
            }

            .top-navbar h1 {
                font-size: 1.5rem;
            }

            .content-wrapper {
                padding: 20px 16px;
            }

            .table-controls {
                flex-direction: column;
            }

            .search-box,
            .filter-select {
                min-width: 100%;
            }

            .stat-card {
                padding: 24px;
            }

            .stat-card h3 {
                font-size: 2rem;
            }
        }

        /* Loading Animation */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 48px;
        }

        .spinner {
            width: 48px;
            height: 48px;
            border: 4px solid var(--border-color);
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Message Display */
        .message-alert {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1050;
            padding: 15px 20px;
            border-radius: 12px;
            box-shadow: var(--shadow-md);
            font-weight: 600;
            display: none; /* Hidden by default */
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }

        .message-alert.show {
            display: block;
            opacity: 1;
        }

        .message-alert.success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .message-alert.error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <div id="loginPage" class="login-container">
        <div class="login-card">
            <h2 class="login-title">Welcome Back</h2>
            <p class="login-subtitle">Sign in to your admin dashboard</p>
            <form id="loginForm">
                <input type="email" id="email" class="form-control" placeholder="Email address" required>
                <input type="password" id="password" class="form-control" placeholder="Password" required>
                <button type="submit" class="btn-login">
                    <i class="fas fa-sign-in-alt me-2"></i>Sign In
                </button>
            </form>
        </div>
    </div>

    <div id="dashboardPage" class="dashboard-container">
        <div class="sidebar">
            <div class="sidebar-header">
                <h3><i class="fas fa-graduation-cap me-2"></i>SkillGate</h3>
            </div>
            <nav class="sidebar-nav">
                <a href="#" class="nav-link active" data-section="dashboard">
                    <i class="fas fa-chart-line"></i>Dashboard
                </a>
                <a href="#" class="nav-link" data-section="enrollments">
                    <i class="fas fa-users"></i>Enrollments
                </a>
                <a href="#" class="nav-link" data-section="analytics">
                    <i class="fas fa-chart-pie"></i>Analytics
                </a>
                <a href="#" class="nav-link" data-section="settings">
                    <i class="fas fa-cog"></i>Settings
                </a>
                <a href="#" class="nav-link" data-section="export">
                    <i class="fas fa-download"></i>Export Data
                </a>
            </nav>
        </div>

        <div class="main-content">
            <div class="top-navbar">
                <h1 id="pageTitle">Dashboard Overview</h1>
                <div class="user-info">
                    <span id="userEmail">admin@skillgate.com</span>
                    <button class="btn-logout">
                        <i class="fas fa-sign-out-alt me-1"></i>Logout
                    </button>
                </div>
            </div>

            <div class="content-wrapper">
                <div id="messageAlert" class="message-alert"></div>

                <div id="dashboard" class="content-section active">
                    <div class="section-title">
                        <i class="fas fa-chart-line"></i>Dashboard Overview
                    </div>
                    
                    <div class="row stats-row">
                        <div class="col-lg-3 col-md-6 mb-4">
                            <div class="stat-card primary">
                                <div class="icon">
                                    <i class="fas fa-users"></i>
                                </div>
                                <h3 id="totalEnrollments">0</h3>
                                <p>Total Enrollments</p>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6 mb-4">
                            <div class="stat-card success">
                                <div class="icon">
                                    <i class="fas fa-user-plus"></i>
                                </div>
                                <h3 id="todayEnrollments">0</h3>
                                <p>Today's Enrollments</p>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6 mb-4">
                            <div class="stat-card warning">
                                <div class="icon">
                                    <i class="fas fa-book-open"></i>
                                </div>
                                <h3 id="totalCourses">0</h3>
                                <p>Active Courses</p>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6 mb-4">
                            <div class="stat-card danger">
                                <div class="icon">
                                    <i class="fas fa-rupee-sign"></i>
                                </div>
                                <h3 id="totalRevenue">â‚¹0</h3>
                                <p>Total Revenue</p>
                            </div>
                        </div>
                    </div>

                    <div class="table-card">
                        <h3 class="table-title">Recent Enrollments</h3>
                        <div id="recentEnrollmentsTable">
                            <div class="loading">
                                <div class="spinner"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="enrollments" class="content-section">
                    <div class="section-title">
                        <i class="fas fa-users"></i>Student Enrollments
                    </div>
                    
                    <div class="table-card">
                        <div class="table-header">
                            <h3 class="table-title">All Enrollments</h3>
                            <div class="table-controls">
                                <input type="text" id="searchStudents" class="search-box" placeholder="Search students...">
                                <select id="filterCourse" class="filter-select">
                                    <option value="">All Courses</option>
                                </select>
                                <select id="filterCity" class="filter-select">
                                    <option value="">All Cities</option>
                                </select>
                                <button class="btn-export" data-format="csv">
                                    <i class="fas fa-file-csv me-1"></i>Export CSV
                                </button>
                            </div>
                        </div>
                        <div class="table-responsive">
                            <table id="enrollmentsTable" class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Email</th>
                                        <th>Phone</th>
                                        <th>City</th>
                                        <th>Course</th>
                                        <th>Price</th>
                                        <th>Date & Time</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    </tbody>
                            </table>
                        </div>
                    </div>
                </div>

                <div id="analytics" class="content-section">
                    <div class="section-title">
                        <i class="fas fa-chart-pie"></i>Course Analytics
                    </div>
                    
                    <div class="row">
                        <div class="col-lg-6 mb-4">
                            <div class="chart-container">
                                <h3 class="chart-title">Enrollments by Course</h3>
                                <div class="chart-wrapper">
                                    <canvas id="courseChart"></canvas>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6 mb-4">
                            <div class="chart-container">
                                <h3 class="chart-title">Monthly Enrollments</h3>
                                <div class="chart-wrapper">
                                    <canvas id="monthlyChart"></canvas>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="settings" class="content-section">
                    <div class="section-title">
                        <i class="fas fa-cog"></i>Settings
                    </div>
                    
                    <div class="settings-card">
                        <h3 class="settings-title">Admin Settings</h3>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="autoRefresh">
                            <label class="form-check-label" for="autoRefresh">
                                Enable auto-refresh every 30 seconds
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="notifications">
                            <label class="form-check-label" for="notifications">
                                Show new enrollment notifications
                            </label>
                        </div>
                    </div>
                </div>

                <div id="export" class="content-section">
                    <div class="section-title">
                        <i class="fas fa-download"></i>Export Data
                    </div>
                    
                    <div class="settings-card">
                        <h3 class="settings-title">Export Options</h3>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="includePersonal" checked>
                                    <label class="form-check-label" for="includePersonal">
                                        Include personal data (name, email, phone)
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="includeAddress" checked>
                                    <label class="form-check-label" for="includeAddress">
                                        Include address information
                                    </label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="includeCourse" checked>
                                    <label class="form-check-label" for="includeCourse">
                                        Include course details
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <h5>Date Range</h5>
                                <div class="mb-3">
                                    <label for="startDate" class="form-label">Start Date</label>
                                    <input type="date" class="form-control" id="startDate">
                                </div>
                                <div class="mb-3">
                                    <label for="endDate" class="form-label">End Date</label>
                                    <input type="date" class="form-control" id="endDate">
                                </div>
                            </div>
                        </div>
                        <div class="mt-3">
                            <button class="btn btn-primary me-2 btn-export" data-format="csv">
                                <i class="fas fa-file-csv me-1"></i>Export as CSV
                            </button>
                            <button class="btn btn-success me-2 btn-export" data-format="excel">
                                <i class="fas fa-file-excel me-1"></i>Export as Excel
                            </button>
                            <button class="btn btn-info me-2 btn-export" data-format="json">
                                <i class="fas fa-file-code me-1"></i>Export as JSON
                            </button>
                            <button class="btn btn-warning" id="generateReportBtn">
                                <i class="fas fa-file-pdf me-1"></i>Generate Report
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="editModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Student</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="editForm">
                        <input type="hidden" id="editId">
                        <div class="mb-3">
                            <label for="editName" class="form-label">Full Name</label>
                            <input type="text" class="form-control" id="editName" required>
                        </div>
                        <div class="mb-3">
                            <label for="editEmail" class="form-label">Email</label>
                            <input type="email" class="form-control" id="editEmail" required>
                        </div>
                        <div class="mb-3">
                            <label for="editPhone" class="form-label">Phone</label>
                            <input type="tel" class="form-control" id="editPhone" required>
                        </div>
                        <div class="mb-3">
                            <label for="editCity" class="form-label">City</label>
                            <input type="text" class="form-control" id="editCity" required>
                        </div>
                        <div class="mb-3">
                            <label for="editCourse" class="form-label">Course</label>
                            <input type="text" class="form-control" id="editCourse" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveEditBtn">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="deleteConfirmModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Confirm Deletion</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    Are you sure you want to delete this student's enrollment? This action cannot be undone.
                    <input type="hidden" id="deleteId">
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteBtn">Delete</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.10.0/firebase-app.js';
        import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/11.10.0/firebase-auth.js';
        import { getFirestore, collection, getDocs, doc, updateDoc, deleteDoc, query, orderBy } from 'https://www.gstatic.com/firebasejs/11.10.0/firebase-firestore.js';
        import { getAnalytics } from 'https://www.gstatic.com/firebasejs/11.10.0/firebase-analytics.js';

        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyCUUN9COE_YHVbxoIb4Cz0SoSwn4-nzObQ",
            authDomain: "enrollment-data-82506.firebaseapp.com",
            projectId: "enrollment-data-82506",
            storageBucket: "enrollment-data-82506.firebasestorage.app",
            messagingSenderId: "923929486744",
            appId: "1:923929486744:web:5c4621d068a44e47fc77ed",
            measurementId: "G-MFEJPVFQJW"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const analytics = getAnalytics(app);

        // --- EMAILJS SETUP ---
        const EMAILJS_USER_ID = "KU4KQRBITiPfUBiQr"; 
        const EMAILJS_SERVICE_ID = "service_awkl67c";
        const EMAILJS_TEMPLATE_ID = "template_jbq1bxm";
        emailjs.init(EMAILJS_USER_ID);

        // App State
        let enrollmentsData = [];
        let enrollmentsTable = null;

        // Utility function to display messages
        function showMessage(message, type) {
            const messageAlert = $('#messageAlert');
            messageAlert.text(message).removeClass('success error').addClass(type).addClass('show');
            setTimeout(() => {
                messageAlert.removeClass('show');
            }, 3000);
        }

        // --- Core Functions ---

        async function loadEnrollments() {
            try {
                const q = query(collection(db, 'enrollments'), orderBy('timestamp', 'desc'));
                const querySnapshot = await getDocs(q);
                
                enrollmentsData = querySnapshot.docs.map(doc => ({
                    id: doc.id,
                    status: doc.data().status || 'inactive',
                    ...doc.data()
                }));

                updateStats();
                updateEnrollmentsTable();
                updateRecentEnrollments();
                populateFilters();

            } catch (error) {
                console.error('Error loading enrollments:', error);
                showMessage('Error loading enrollments: ' + error.message, 'error');
            }
        }

        function updateEnrollmentsTable() {
            if (enrollmentsTable) {
                enrollmentsTable.destroy();
            }

            const tbody = $('#enrollmentsTable tbody');
            tbody.empty(); // Clear existing rows

            if (enrollmentsData.length === 0) {
                tbody.html('<tr><td colspan="9" class="text-center">No enrollments found.</td></tr>');
                return;
            }

            enrollmentsData.forEach(item => {
                const dateTime = (item.enrollmentDate && item.enrollmentTime) ? `${item.enrollmentDate} ${item.enrollmentTime}` : (item.enrollmentDate || item.enrollmentTime || 'N/A');
                
                const row = `
                    <tr>
                        <td>${item.fullName || 'N/A'}</td>
                        <td>${item.email || 'N/A'}</td>
                        <td>${item.phone || 'N/A'}</td>
                        <td>${item.city || 'N/A'}</td>
                        <td>${item.courseTitle || 'N/A'}</td>
                        <td>${item.coursePrice || 'N/A'}</td>
                        <td>${dateTime}</td>
                        <td>
                            <span 
                                class="status-badge status-${item.status}" 
                                data-id="${item.id}" 
                                data-email="${item.email}" 
                                data-name="${item.fullName}"
                                data-status="${item.status}">
                                ${item.status}
                            </span>
                        </td>
                        <td>
                            <button class="btn-action btn-edit" data-id="${item.id}"><i class="fas fa-edit"></i></button>
                            <button class="btn-action btn-delete" data-id="${item.id}"><i class="fas fa-trash"></i></button>
                        </td>
                    </tr>
                `;
                tbody.append(row);
            });

            enrollmentsTable = $('#enrollmentsTable').DataTable({
                responsive: true,
                pageLength: 10,
                order: [[6, 'desc']],
                language: { search: "", searchPlaceholder: "Search enrollments..." }
            });
        }
        
        // --- Event Handlers ---

        function handleLogin(e) {
            e.preventDefault();
            const email = $('#email').val();
            const password = $('#password').val();
            signInWithEmailAndPassword(auth, email, password).catch(error => {
                const errorMessage = 'Login failed: ' + error.message;
                console.error(errorMessage);
                showMessage(errorMessage, 'error');
            });
        }

        function logout() {
            signOut(auth);
        }

        function showSection(sectionName) {
            $('.nav-link').removeClass('active');
            $(`.nav-link[data-section="${sectionName}"]`).addClass('active');
            $('.content-section').removeClass('active');
            $(`#${sectionName}`).addClass('active');
            
            const titles = {
                dashboard: 'Dashboard Overview',
                enrollments: 'Student Enrollments',
                analytics: 'Course Analytics',
                settings: 'Settings',
                export: 'Export Data'
            };
            $('#pageTitle').text(titles[sectionName]);
            
            if (sectionName === 'analytics') {
                loadCharts();
            }
        }

        function filterTable() {
            if (!enrollmentsTable) return;
            const searchTerm = $('#searchStudents').val();
            const courseFilter = $('#filterCourse').val();
            const cityFilter = $('#filterCity').val();

            enrollmentsTable.search(searchTerm);
            enrollmentsTable.column(4).search(courseFilter ? `^${courseFilter}$` : '', true, false);
            enrollmentsTable.column(3).search(cityFilter ? `^${cityFilter}$` : '', true, false);
            enrollmentsTable.draw();
        }

        async function changeStatus(id, newStatus, userEmail, userName) {
            const userDocRef = doc(db, 'enrollments', id);
            try {
                await updateDoc(userDocRef, { status: newStatus });
                showMessage(`Status updated to ${newStatus}`, 'success');
                
                // Find the specific data item and update its status locally
                const item = enrollmentsData.find(d => d.id === id);
                if(item) item.status = newStatus;

                // Redraw the table to reflect the change without a full reload
                updateEnrollmentsTable();

                if (newStatus === 'active') {
                    // Find the enrollment data to get course name and date
                    const enrollment = enrollmentsData.find(enrollment => enrollment.id === id);
                    const courseName = enrollment ? enrollment.courseTitle : 'N/A';
                    const enrollmentDate = enrollment ? enrollment.enrollmentDate : 'N/A';
                    sendActivationEmail(userEmail, userName, courseName, enrollmentDate);
                }
                

            } catch (error) {
                console.error("Error updating status:", error);
                showMessage('Failed to update status: ' + error.message, 'error');
            }
        }

        function editStudent(id) {
            const student = enrollmentsData.find(item => item.id === id);
            if (!student) {
                showMessage('Student not found for editing.', 'error');
                return;
            }
            $('#editId').val(id);
            $('#editName').val(student.fullName || '');
            $('#editEmail').val(student.email || '');
            $('#editPhone').val(student.phone || '');
            $('#editCity').val(student.city || '');
            $('#editCourse').val(student.courseTitle || '');
            new bootstrap.Modal($('#editModal')).show();
        }

        async function saveEdit() {
            const id = $('#editId').val();
            const updatedData = {
                fullName: $('#editName').val(),
                email: $('#editEmail').val(),
                phone: $('#editPhone').val(),
                city: $('#editCity').val(),
                courseTitle: $('#editCourse').val()
            };
            try {
                await updateDoc(doc(db, 'enrollments', id), updatedData);
                bootstrap.Modal.getInstance($('#editModal')).hide();
                loadEnrollments();
                showMessage('Student updated successfully!', 'success');
            } catch (error) {
                console.error('Error updating student: ' + error.message);
                showMessage('Error updating student: ' + error.message, 'error');
            }
        }

        function showDeleteConfirm(id) {
            $('#deleteId').val(id);
            new bootstrap.Modal($('#deleteConfirmModal')).show();
        }

        async function confirmDelete() {
            const id = $('#deleteId').val();
            try {
                await deleteDoc(doc(db, 'enrollments', id));
                bootstrap.Modal.getInstance($('#deleteConfirmModal')).hide();
                loadEnrollments();
                showMessage('Student deleted successfully!', 'success');
            } catch (error) {
                console.error('Error deleting student: ' + error.message);
                showMessage('Error deleting student: ' + error.message, 'error');
            }
        }

        function exportData(format) {
            if (enrollmentsData.length === 0) { showMessage('No data to export', 'warning'); return; }
            const data = enrollmentsData.map(item => ({
                Name: item.fullName || '', Email: item.email || '', Phone: item.phone || '', City: item.city || '', Course: item.courseTitle || '', Price: item.coursePrice || '',
                'Date & Time': (item.enrollmentDate && item.enrollmentTime) ? `${item.enrollmentDate} ${item.enrollmentTime}` : (item.enrollmentDate || item.enrollmentTime || ''),
                Status: item.status || 'inactive', Timestamp_ISO: item.timestamp || ''
            }));
            if (format === 'csv') exportToCSV(data);
            else if (format === 'json') exportToJSON(data);
            else if (format === 'excel') showMessage('Excel export feature coming soon!', 'info');
        }

        // --- Helper Functions (unchanged logic) ---
        function updateStats() {
             const total = enrollmentsData.length;
            const today = new Date().toLocaleDateString();
            const todayCount = enrollmentsData.filter(item => item.enrollmentDate === today).length;
            const courses = [...new Set(enrollmentsData.map(item => item.courseTitle))].filter(Boolean);
            const totalRevenue = enrollmentsData.reduce((sum, item) => sum + (parseFloat(item.coursePrice?.replace(/[PKR,]/g, '')) || 0), 0);
            $('#totalEnrollments').text(total);
            $('#todayEnrollments').text(todayCount);
            $('#totalCourses').text(courses.length);
            $('#totalRevenue').text(`PKR ${totalRevenue.toLocaleString()}`);
        }

        function updateRecentEnrollments() {
            const recent = enrollmentsData.slice(0, 5);
            const container = $('#recentEnrollmentsTable');
            container.empty();
            if (recent.length === 0) {
                container.html('<p class="text-center text-muted">No recent enrollments found</p>');
                return;
            }
            let html = `<div class="table-responsive"><table class="table table-striped"><thead><tr><th>Name</th><th>Course</th><th>Date & Time</th><th>Price</th></tr></thead><tbody>`;
            recent.forEach(item => {
                const dateTime = (item.enrollmentDate && item.enrollmentTime) ? `${item.enrollmentDate} ${item.enrollmentTime}` : (item.enrollmentDate || item.enrollmentTime || 'N/A');
                html += `<tr><td>${item.fullName || 'N/A'}</td><td>${item.courseTitle || 'N/A'}</td><td>${dateTime}</td><td>${item.coursePrice || 'N/A'}</td></tr>`;
            });
            html += '</tbody></table></div>';
            container.html(html);
        }

        function populateFilters() {
            const courses = [...new Set(enrollmentsData.map(item => item.courseTitle))].filter(Boolean);
            const cities = [...new Set(enrollmentsData.map(item => item.city))].filter(Boolean);
            const courseSelect = $('#filterCourse');
            const citySelect = $('#filterCity');
            courseSelect.html('<option value="">All Courses</option>');
            citySelect.html('<option value="">All Cities</option>');
            courses.forEach(course => courseSelect.append(`<option value="${course}">${course}</option>`));
            cities.forEach(city => citySelect.append(`<option value="${city}">${city}</option>`));
        }

        function sendActivationEmail(userEmail, userName, courseName, enrollmentDate) {
            if (!EMAILJS_USER_ID || EMAILJS_USER_ID === "YOUR_USER_ID") {
                console.warn("EmailJS is not configured. Skipping email.");
                showMessage("Email not sent: EmailJS is not configured.", "error");
                return;
            }
            const templateParams = {
                to_email: userEmail,
                to_name: userName,
                from_name: "SkillGate Admin",
                course_name: courseName, // Add this line
                enrollment_date: enrollmentDate // Add this line
            };
            emailjs.send(EMAILJS_SERVICE_ID, EMAILJS_TEMPLATE_ID, templateParams)
                .then(response => {
                   console.log('SUCCESS!', response.status, response.text);
                   showMessage(`Activation email sent to ${userEmail}`, 'success');
                }, error => {
                   console.log('FAILED...', error);
                   showMessage(`Failed to send email: ${error.text}`, 'error');
                });
        }

        function loadCharts() {
            const existingCourseChart = Chart.getChart('courseChart');
            if (existingCourseChart) existingCourseChart.destroy();
            const existingMonthlyChart = Chart.getChart('monthlyChart');
            if (existingMonthlyChart) existingMonthlyChart.destroy();
            loadCourseChart();
            loadMonthlyChart();
        }

        function loadCourseChart() {
            const ctx = document.getElementById('courseChart').getContext('2d');
            const courseCounts = {};
            enrollmentsData.forEach(item => {
                const course = item.courseTitle || 'Unknown';
                courseCounts[course] = (courseCounts[course] || 0) + 1;
            });
            new Chart(ctx, { type: 'doughnut', data: { labels: Object.keys(courseCounts), datasets: [{ data: Object.values(courseCounts), backgroundColor: ['#3B82F6', '#10B981', '#F59E0B', '#EF4444', '#8B5CF6', '#EC4899'] }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom', labels: { color: '#1E293B', font: { family: 'Inter' } } } } } });
        }

        function loadMonthlyChart() {
            const ctx = document.getElementById('monthlyChart').getContext('2d');
            const monthCounts = {};
            enrollmentsData.forEach(item => {
                if (item.timestamp) {
                    const month = new Date(item.timestamp).toLocaleDateString('en-US', { year: 'numeric', month: 'short' });
                    monthCounts[month] = (monthCounts[month] || 0) + 1;
                }
            });
            new Chart(ctx, { type: 'line', data: { labels: Object.keys(monthCounts), datasets: [{ label: 'Enrollments', data: Object.values(monthCounts), borderColor: '#3B82F6', backgroundColor: 'rgba(59, 130, 246, 0.1)', tension: 0.4, fill: true }] }, options: { responsive: true, maintainAspectRatio: false, scales: { y: { beginAtZero: true, ticks: { stepSize: 1, color: '#64748B', font: { family: 'Inter' } }, grid: { color: '#E2E8F0' } }, x: { ticks: { color: '#64748B', font: { family: 'Inter' } }, grid: { color: '#E2E8F0' } } }, plugins: { legend: { display: false } } } });
        }

        function exportToCSV(data) {
            const headers = Object.keys(data[0]);
            const csvContent = [ headers.join(','), ...data.map(row => headers.map(header => `"${row[header]}"`).join(',')) ].join('\n');
            downloadFile(csvContent, 'enrollments.csv', 'text/csv');
        }

        function exportToJSON(data) {
            const jsonContent = JSON.stringify(data, null, 2);
            downloadFile(jsonContent, 'enrollments.json', 'application/json');
        }

        function downloadFile(content, filename, contentType) {
            const blob = new Blob([content], { type: contentType });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }

        function generateReport() {
            if (enrollmentsData.length === 0) {
                showMessage('No data to generate report', 'warning');
                return;
            }

            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            const columns = [
                { header: 'Name', dataKey: 'fullName' },
                { header: 'Email', dataKey: 'email' },
                { header: 'Phone', dataKey: 'phone' },
                { header: 'City', dataKey: 'city' },
                { header: 'Course', dataKey: 'courseTitle' },
                { header: 'Price', dataKey: 'coursePrice' },
                { header: 'Date & Time', dataKey: 'dateTime' },
                { header: 'Status', dataKey: 'status' }
            ];

            const rows = enrollmentsData.map(item => ({
                fullName: item.fullName || 'N/A',
                email: item.email || 'N/A',
                phone: item.phone || 'N/A',
                city: item.city || 'N/A',
                courseTitle: item.courseTitle || 'N/A',
                coursePrice: item.coursePrice || 'N/A',
                dateTime: (item.enrollmentDate && item.enrollmentTime) ? `${item.enrollmentDate} ${item.enrollmentTime}` : (item.enrollmentDate || item.enrollmentTime || 'N/A'),
                status: item.status || 'inactive'
            }));

            doc.text("SkillGate Enrollment Report", 14, 20);
            doc.autoTable({
                startY: 30,
                head: [columns.map(col => col.header)],
                body: rows.map(row => columns.map(col => row[col.dataKey])),
                theme: 'striped',
                headStyles: { fillColor: [16, 185, 129] }, // Green header
                styles: { fontSize: 8, cellPadding: 3 },
                columnStyles: {
                    fullName: { cellWidth: 30 },
                    email: { cellWidth: 40 },
                    phone: { cellWidth: 25 },
                    city: { cellWidth: 20 },
                    courseTitle: { cellWidth: 30 },
                    coursePrice: { cellWidth: 20 },
                    dateTime: { cellWidth: 30 },
                    status: { cellWidth: 20 }
                },
                didDrawPage: function(data) {
                    // Footer
                    let str = "Page " + doc.internal.getNumberOfPages();
                    doc.setFontSize(10);
                    doc.text(str, data.settings.margin.left, doc.internal.pageSize.height - 10);
                }
            });

            doc.save('enrollment_report.pdf');
            showMessage('PDF report generated successfully!', 'success');
        }


        // --- App Initialization ---
        
        function setupEventListeners() {
            // Login
            $('#loginForm').on('submit', handleLogin);
            
            // Logout
            $('.btn-logout').on('click', logout);

            // Navigation
            $('.sidebar-nav').on('click', '.nav-link', function(e) {
                e.preventDefault();
                showSection($(this).data('section'));
            });

            // Table Filters
            $('#searchStudents, #filterCourse, #filterCity').on('input change', filterTable);

            // Export and Report Buttons
            $('.content-wrapper').on('click', '.btn-export', function() {
                exportData($(this).data('format'));
            });
            $('#generateReportBtn').on('click', generateReport);

            // --- Dynamic Event Delegation for Table Actions ---
            $('#enrollmentsTable tbody').on('click', '.btn-edit', function() {
                editStudent($(this).data('id'));
            });

            $('#enrollmentsTable tbody').on('click', '.btn-delete', function() {
                showDeleteConfirm($(this).data('id'));
            });

            $('#enrollmentsTable tbody').on('click', '.status-badge', function() {
                const $badge = $(this);
                const id = $badge.data('id');
                const currentStatus = $badge.data('status');
                const email = $badge.data('email');
                const name = $badge.data('name');
                const newStatus = currentStatus === 'active' ? 'inactive' : 'active';
                changeStatus(id, newStatus, email, name);
            });

            // Modal Buttons
            $('#saveEditBtn').on('click', saveEdit);
            $('#confirmDeleteBtn').on('click', confirmDelete);
        }

        function initializeAdmin() {
            onAuthStateChanged(auth, (user) => {
                if (user) {
                    $('#loginPage').hide();
                    $('#dashboardPage').show();
                    $('#userEmail').text(user.email);
                    loadEnrollments();
                } else {
                    $('#loginPage').show();
                    $('#dashboardPage').hide();
                }
            });
            setupEventListeners();
        }

        // Run on document ready
        $(document).ready(function() {
            initializeAdmin();
        });

    </script>
</body>
</html>